<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ma Liste de Courses</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Spline+Sans:wght@400;500;700"
    />
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <main
      class="relative flex size-full min-h-screen flex-col justify-between overflow-x-hidden bg-[#111714] text-white dark group/design-root"
      style="font-family: 'Spline Sans', 'Noto Sans', sans-serif"
    >
      <div>
        <header class="flex items-center justify-between bg-[#111714] p-4 pb-2">
          <a href="/produit.html" class="flex h-12 w-12 shrink-0 items-center text-white">
            <div data-icon="ArrowLeft" data-size="24px" data-weight="regular"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path></svg></div>
          </a>
          <h2 class="flex-1 pr-12 text-center text-lg font-bold leading-tight tracking-[-0.015em]">Ma Liste de Courses</h2>
        </header>

        <!-- ====================== PRODUIT DYNAMIQUE ====================== -->
        <!-- J'ai ajouté des 'data-attributes' pour que le JavaScript puisse fonctionner -->
        <div class="product-item flex min-h-[72px] items-center justify-between gap-4 bg-[#111714] px-4 py-2" data-price="0.91">
          <div class="flex items-center gap-4">
            <div class="size-14 shrink-0 rounded-lg bg-cover bg-center bg-no-repeat" style='background-image: url("https://corporate.tiptoque.com/cdn/shop/products/bouteille_evian_-_2_1000x_crop_center.jpg?v=1544013485");'></div>
            <div class="flex flex-col justify-center">
              <p class="line-clamp-1 text-base font-medium leading-normal">Bouteille Evian 33CL</p>
              <p class="product-price line-clamp-2 text-sm font-normal leading-normal text-[#9eb7a8]">Prix promo: 0.91€</p>
            </div>
          </div>
          <div class="shrink-0">
            <div class="flex items-center gap-2 text-white">
              <button class="quantity-btn flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-[#29382f] text-base font-medium leading-normal" data-action="minus">-</button>
              <span class="quantity-value w-4 p-0 text-center text-base font-medium leading-normal">1</span>
              <button class="quantity-btn flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-[#29382f] text-base font-medium leading-normal" data-action="plus">+</button>
            </div>
          </div>
        </div>
        <!-- ==================== FIN PRODUIT DYNAMIQUE ==================== -->

        <!-- Espace pour d'autres produits si besoin -->

        <h3 id="total-price" class="px-4 pb-2 pt-4 text-lg font-bold leading-tight tracking-[-0.015em]">Total Estimé: 0.91€</h3>
        <div class="flex justify-stretch">
          <div class="flex flex-1 flex-wrap justify-between gap-3 px-4 py-3">
            <button class="flex h-10 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full bg-[#29382f] px-4 text-sm font-bold leading-normal tracking-[0.015em] text-white">
              <span class="truncate">Partager</span>
            </button>
            <button class="flex h-10 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full !bg-[#38e07b] px-4 text-sm font-bold leading-normal tracking-[0.015em] text-[#111714]">
              <span class="truncate">Valider la Liste</span>
            </button>
          </div>
        </div>
      </div>
      <footer class="mt-auto">
        <!-- ... Barre de navigation ... -->
      </footer>
    </main>

    <!-- ======================= LE SCRIPT DYNAMIQUE ======================= -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {

        // --- FONCTION PRINCIPALE DE MISE À JOUR ---
        function updateTotalPrice() {
          let total = 0;
          const productItems = document.querySelectorAll('.product-item');

          productItems.forEach(item => {
            const price = parseFloat(item.dataset.price);
            const quantity = parseInt(item.querySelector('.quantity-value').textContent);
            
            // Logique de promotion: le 6ème est gratuit
            const freeItems = Math.floor(quantity / 6);
            const billableItems = quantity - freeItems;
            
            total += billableItems * price;
          });

          // Met à jour l'affichage du total
          const totalPriceElement = document.getElementById('total-price');
          totalPriceElement.textContent = `Total Estimé: ${total.toFixed(2)}€`;
        }

        // --- GESTION DES BOUTONS + ET - ---
        const productItems = document.querySelectorAll('.product-item');

        productItems.forEach(item => {
          const minusBtn = item.querySelector('[data-action="minus"]');
          const plusBtn = item.querySelector('[data-action="plus"]');
          const quantityValue = item.querySelector('.quantity-value');

          minusBtn.addEventListener('click', () => {
            let currentQuantity = parseInt(quantityValue.textContent);
            if (currentQuantity > 0) { // On ne peut pas avoir une quantité négative
              quantityValue.textContent = currentQuantity - 1;
              updateTotalPrice(); // On recalcule le total
            }
          });

          plusBtn.addEventListener('click', () => {
            let currentQuantity = parseInt(quantityValue.textContent);
            quantityValue.textContent = currentQuantity + 1;
            updateTotalPrice(); // On recalcule le total
          });
        });

        // Calcul initial au chargement de la page
        updateTotalPrice();
      });
    </script>
  </body>
</html>